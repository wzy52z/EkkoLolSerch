<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>LOL å¯¹å±€è¿›åŒ–è®º</title>
    <style>
        :root {
            --bg-dark: #121212;
            --card-bg: #1e1e1e;
            --text-main: #e0e0e0;
            --text-sub: #a0a0a0;
            --accent: #ff4757; /* é€šå¤©ä»£çº¢ */
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* é¡¶éƒ¨å¯¼èˆª */
        .nav {
            background: #2d2d2d;
            padding: 5px;
            border-radius: 30px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }
        .nav button {
            background: transparent;
            border: none;
            color: var(--text-sub);
            padding: 10px 25px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 25px;
            transition: 0.3s;
        }
        .nav button.active {
            background: var(--text-main);
            color: var(--bg-dark);
            font-weight: bold;
        }

        /* æœç´¢æ¡† */
        .search-area {
            display: none;
            gap: 10px;
            margin-bottom: 20px;
        }
        .search-area.show { display: flex; }
        input {
            padding: 12px 20px;
            border-radius: 25px;
            border: 1px solid #444;
            background: #252525;
            color: white;
            width: 250px;
            outline: none;
        }
        .btn-search {
            background: var(--accent);
            color: white;
            border: none;
            padding: 0 25px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
        }

        /* å®æ—¶çŠ¶æ€ç¯ */
        .status-light {
            color: #2ed573;
            font-size: 14px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .dot {
            width: 8px;
            height: 8px;
            background-color: #2ed573;
            border-radius: 50%;
            animation: blink 1.5s infinite;
        }
        @keyframes blink { 50% { opacity: 0.3; } }

        /* å¡ç‰‡å®¹å™¨ */
        .container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
            width: 100%;
            max-width: 1200px;
        }

        /* ç©å®¶å¡ç‰‡ */
        .card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            position: relative;
            overflow: hidden;
            border: 1px solid #333;
            transition: transform 0.2s;
        }
        .card:hover { transform: translateY(-5px); border-color: #555; }

        /* å·¦ä¾§è¾¹æ¡†æ¡ï¼šæ ¹æ®æ®µä½/è¯„çº§å˜è‰² */
        .card::before {
            content: '';
            position: absolute;
            left: 0; top: 0; bottom: 0;
            width: 4px;
            background: #555; /* é»˜è®¤ */
        }
        .card.level-God::before { background: #ff4757; box-shadow: 0 0 10px #ff4757; }
        .card.level-Tiger::before { background: #ffa502; }
        .card.level-Human::before { background: #1e90ff; }
        .card.level-Bug::before { background: #2ed573; }

        .avatar {
            width: 64px;
            height: 64px;
            border-radius: 50%;
            border: 2px solid #333;
        }
        .info { flex: 1; }
        .name { font-size: 18px; font-weight: bold; margin-bottom: 2px; }
        .tag { font-size: 12px; color: #666; background: #111; padding: 2px 6px; border-radius: 4px; margin-left: 5px; }
        .rank { font-size: 13px; color: #888; margin-bottom: 8px; }

        .stats-box {
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            padding: 8px 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .score-title { font-weight: bold; font-size: 14px; }
        .kda { color: var(--text-main); font-weight: bold; }
        .hero-name { font-size: 12px; color: #aaa; margin-top: 4px; display: block;}
    </style>
</head>
<body>

<div class="nav">
    <button id="btnLive" class="active" onclick="setMode('live')">âš¡ å®æ—¶å¯¹å±€</button>
    <button id="btnSearch" onclick="setMode('search')">ğŸ” åå­—æŸ¥è¯¢</button>
</div>

<div id="liveStatus" class="status-light">
    <div class="dot"></div> æ­£åœ¨ç›‘æ§æ¸¸æˆå®¢æˆ·ç«¯...
</div>

<div id="searchArea" class="search-area">
    <input type="text" id="searchInput" placeholder="è¾“å…¥ ID (ä¾‹å¦‚: Faker#KR1)">
    <button class="btn-search" onclick="doSearch()">åˆ†æ</button>
</div>

<div id="cardContainer" class="container"></div>

<script>
    let mode = 'live';
    let timer = null;

    // é¡µé¢åˆå§‹åŒ–
    window.onload = () => {
        setMode('live');
    };

    function setMode(m) {
        mode = m;
        document.getElementById('cardContainer').innerHTML = ''; // æ¸…ç©º

        // åˆ‡æ¢UI
        if (m === 'live') {
            document.getElementById('btnLive').className = 'active';
            document.getElementById('btnSearch').className = '';
            document.getElementById('liveStatus').style.display = 'flex';
            document.getElementById('searchArea').classList.remove('show');

            fetchLiveData();
            if (timer) clearInterval(timer);
            timer = setInterval(fetchLiveData, 2000); // æ¯2ç§’è½®è¯¢ä¸€æ¬¡
        } else {
            document.getElementById('btnLive').className = '';
            document.getElementById('btnSearch').className = 'active';
            document.getElementById('liveStatus').style.display = 'none';
            document.getElementById('searchArea').classList.add('show');

            if (timer) clearInterval(timer);
        }
    }

    // --- æ¥å£ 1: è·å–å®æ—¶æ•°æ® ---
    async function fetchLiveData() {
        try {
            // è°ƒç”¨ AppController çš„ /api/lol/game/live
            const res = await fetch('/api/lol/game/live');
            const data = await res.json();
            renderCards(data);
        } catch (e) {
            console.error("è¿æ¥å¤±è´¥", e);
        }
    }

    // --- æ¥å£ 2: æ‰‹åŠ¨æŸ¥è¯¢ ---
    async function doSearch() {
        const name = document.getElementById('searchInput').value;
        if (!name) return alert("è¯·è¾“å…¥åå­—å’Œç¼–å·ï¼Œå¦‚ï¼šUzi#CN1");

        document.getElementById('cardContainer').innerHTML = '<p style="text-align:center;width:100%;color:#666">æ­£åœ¨åˆ†æå¤§æ•°æ®...</p>';

        try {
            // è°ƒç”¨ AppController çš„ /api/lol/analyze
            const res = await fetch(`/api/lol/analyze?name=${encodeURIComponent(name)}`);
            if (!res.ok) throw new Error("æŸ¥è¯¢å¤±è´¥");
            const data = await res.json();
            renderCards([data]); // è½¬æˆæ•°ç»„æ¸²æŸ“
        } catch (e) {
            document.getElementById('cardContainer').innerHTML = '<p style="text-align:center;width:100%;color:#ff4757">æœªæ‰¾åˆ°ç©å®¶ï¼Œè¯·ç¡®è®¤æ¸¸æˆå·²ç™»å½•</p>';
        }
    }

    // --- æ¸²æŸ“é€»è¾‘ ---
    function renderCards(list) {
        const container = document.getElementById('cardContainer');
        container.innerHTML = ''; // æ¸…ç©ºæ—§æ•°æ®

        if (!list || list.length === 0) {
            if (mode === 'live') {
                container.innerHTML = '<p style="text-align:center;width:100%;color:#555">ç­‰å¾…å¯¹å±€å¼€å§‹...</p>';
            }
            return;
        }

        list.forEach(p => {
            // æ ¹æ®ç§°å·è®¾ç½®é¢œè‰²æ ·å¼
            let levelClass = 'level-Human';
            let color = '#1e90ff';

            if (p.scoreTitle.includes('é€šå¤©ä»£')) { levelClass = 'level-God'; color = '#ff4757'; }
            else if (p.scoreTitle.includes('å‰‘é½¿è™')) { levelClass = 'level-Tiger'; color = '#ffa502'; }
            else if (p.scoreTitle.includes('è‰å±¥è™«')) { levelClass = 'level-Bug'; color = '#2ed573'; }

            // è§£æ KDA æè¿° (å‡è®¾åç«¯ä¼ å›æ¥çš„æ˜¯å­—ç¬¦ä¸²)
            const kdaText = `KDA: ${p.kda}`;

            const html = `
                <div class="card ${levelClass}">
                    <img src="${p.avatarUrl}" class="avatar">
                    <div class="info">
                        <div>
                            <span class="name">${p.name}</span>
                            ${p.tag ? `<span class="tag">#${p.tag}</span>` : ''}
                        </div>
                        <div class="rank">${p.rankTier} Â· ${p.seasonStats}</div>

                        <div class="stats-box">
                            <span class="score-title" style="color:${color}">${p.scoreTitle}</span>
                            <span class="kda">${kdaText}</span>
                        </div>
                        <span class="hero-name">${p.kdaDescription}</span>
                    </div>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', html);
        });
    }
</script>

</body>
</html>